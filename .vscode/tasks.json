{
  // See https://go.microsoft.com/fwlink/?LinkId=733558
  // Schema: https://code.visualstudio.com/docs/reference/tasks-appendix
  "$schema": "vscode://schemas/tasks",
  "version": "2.0.0",
  "inputs": [
    {
      "id": "featureDescription",
      "description": "Enter a brief description of the feature to implement",
      "default": "New indicator or feature",
      "type": "promptString"
    }
  ],
  // defaults
  "group": "none",
  "presentation": {
    "echo": true,
    "reveal": "always",
    "revealProblems": "onProblem",
    "focus": true,
    "panel": "shared",
    "showReuseMessage": false,
    "clear": false
  },
  "problemMatcher": "$msCompile",
  "options": {
    "cwd": "${workspaceFolder}"
  },
  // tasks
  "tasks": [
    {
      "label": "Initialize: Pull, rebuild, fixers, and unit test",
      "detail": "Pull latest, clean, rebuild non-incremental, fix all, and test",
      "dependsOn": [
        "Git: pull",
        "Clean: .NET Solution (dotnet clean)",
        "Build: .NET Solution (not incremental)",
        "Lint: .NET code & markdown files (fix)",
        "Test: Unit tests"
      ],
      "dependsOrder": "sequence",
      "group": "build",
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      }
    },
    {
      "label": "Git: pull",
      "detail": "Pull latest changes from Git",
      "type": "shell",
      "command": "git pull || echo 'No remote branch!'",
      "problemMatcher": []
    },
    {
      "label": "Install: All code dependencies",
      "detail": "Restore .NET packages",
      "dependsOn": [
        "Install: .NET packages",
        "Install: NPM (pnpm) packages"
      ],
      "dependsOrder": "parallel"
    },
    {
      "label": "Install: .NET packages",
      "detail": "Restore NuGet packages for solution",
      "type": "shell",
      "command": "dotnet restore",
      "problemMatcher": "$msCompile",
      "presentation": {
        "group": "install"
      }
    },
    {
      "label": "Install: NPM (pnpm) packages",
      "detail": "Install pnpm packages for docs site (VitePress), ensuring pnpm@10.24.0 is present",
      "type": "shell",
      "command": "if command -v corepack > /dev/null 2>&1; then corepack enable && corepack prepare pnpm@10.24.0 --activate; else npm install -g pnpm@10.24.0; fi && pnpm --version && pnpm install",
      "options": {
        "cwd": "${workspaceFolder}/docs"
      },
      "problemMatcher": [],
      "presentation": {
        "group": "install"
      }
    },
    {
      "label": "Update: NPM (pnpm) packages",
      "detail": "Update pnpm packages for docs site",
      "type": "shell",
      "command": "pnpm update",
      "options": {
        "cwd": "${workspaceFolder}/docs"
      },
      "problemMatcher": [],
      "presentation": {
        "group": "install"
      }
    },
    {
      "label": "Clean: .NET Solution (dotnet clean)",
      "detail": "Clean build outputs (bin/obj) for solution",
      "type": "shell",
      "command": "dotnet clean -v minimal --nologo",
      "group": "build",
      "problemMatcher": "$msCompile"
    },
    {
      "label": "Delete: Temporary caches (and restore)",
      "detail": "Delete bin, obj, node_modules, other caches, and lock files",
      "type": "shell",
      "command": "bash tools/scripts/clean.sh",
      "group": "build",
      "problemMatcher": "$msCompile",
      "presentation": {
        "group": "install"
      }
    },
    {
      "label": "Delete: Temporary caches (and build)",
      "detail": "Delete temporary caches then rebuild",
      "type": "shell",
      "command": "bash tools/scripts/clean.sh && dotnet build --no-incremental",
      "group": "build",
      "problemMatcher": "$msCompile",
      "presentation": {
        "group": "install"
      }
    },
    {
      "label": "Build: .NET Solution (incremental)",
      "detail": "Incremental build of solution (default)",
      "type": "shell",
      "command": "dotnet build -v minimal --nologo",
      "group": {
        "kind": "build",
        "isDefault": true
      },
      "problemMatcher": "$msCompile"
    },
    {
      "label": "Build: .NET Solution (not incremental)",
      "detail": "Full rebuild without incremental compilation",
      "type": "shell",
      "command": "dotnet build -v minimal --nologo --no-incremental",
      "group": "build",
      "problemMatcher": "$msCompile"
    },
    {
      "label": "Lint: .NET code (format check)",
      "detail": "Verify code formatting and style",
      "type": "shell",
      "command": "dotnet format --verify-no-changes --severity info --no-restore",
      "group": "test",
      "problemMatcher": "$msCompile",
      "presentation": {
        "group": "analysis"
      }
    },
    {
      "label": "Lint: .NET code (full analysis)",
      "detail": "Run Roslynator analysis and .NET format check",
      "type": "shell",
      "command": "bash tools/scripts/lint-code-check.sh",
      "group": "test",
      "problemMatcher": "$msCompile",
      "dependsOn": [
        "Build: .NET Solution (incremental)"
      ],
      "dependsOrder": "sequence",
      "presentation": {
        "group": "analysis"
      }
    },
    {
      "label": "Lint: .NET code (fix)",
      "detail": "Auto-fix .NET code formatting issues",
      "type": "shell",
      "command": "bash tools/scripts/lint-code-fix.sh",
      "group": "none",
      "problemMatcher": "$msCompile",
      "presentation": {
        "group": "analysis"
      }
    },
    {
      "label": "Lint: Markdown files",
      "detail": "Run markdownlint over documentation",
      "type": "shell",
      "command": "pnpm dlx markdownlint-cli2",
      "group": "test",
      "problemMatcher": "$markdownlint",
      "presentation": {
        "group": "analysis"
      }
    },
    {
      "label": "Lint: Markdown files (fix)",
      "detail": "Auto-fix markdown formatting issues",
      "type": "shell",
      "command": "pnpm dlx markdownlint-cli2 --fix",
      "group": "none",
      "problemMatcher": "$markdownlint",
      "presentation": {
        "group": "analysis"
      }
    },
    {
      "label": "Lint: .NET code & markdown files",
      "detail": "Run all linting checks (code + markdown) in sequence",
      "dependsOn": [
        "Build: .NET Solution (incremental)",
        "Lint: .NET code (full analysis)",
        "Lint: Markdown files"
      ],
      "dependsOrder": "sequence",
      "group": "test",
      "problemMatcher": [
        "$msCompile",
        "$markdownlint"
      ],
      "presentation": {
        "group": "analysis"
      }
    },
    {
      "label": "Lint: .NET code & markdown files (fix)",
      "detail": "Auto-fix code format and markdown issues",
      "dependsOn": [
        "Build: .NET Solution (incremental)",
        "Lint: .NET code (fix)",
        "Lint: Markdown files (fix)"
      ],
      "dependsOrder": "sequence",
      "group": "none",
      "problemMatcher": [
        "$msCompile",
        "$markdownlint"
      ],
      "presentation": {
        "group": "analysis"
      }
    },
    {
      "label": "CI: Verify (build + lint + unit test)",
      "detail": "Complete CI verification: build, lint, and test",
      "dependsOn": [
        "Build: .NET Solution (incremental)",
        "Lint: .NET code & markdown files",
        "Test: Unit tests"
      ],
      "dependsOrder": "sequence",
      "group": "test",
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      }
    },
    {
      "label": "Test: Unit tests",
      "detail": "Run unit tests only (excludes integration and regression tests)",
      "type": "shell",
      "command": "dotnet test tests/indicators/Tests.Indicators.csproj --no-restore --nologo --settings tests/tests.unit.runsettings",
      "group": {
        "kind": "test",
        "isDefault": true
      },
      "problemMatcher": "$msCompile",
      "presentation": {
        "clear": true
      }
    },
    {
      "label": "Test: Regression tests",
      "detail": "Run regression tests only (baseline validation)",
      "type": "shell",
      "command": "dotnet test tests/indicators/Tests.Indicators.csproj --no-restore --nologo --settings tests/tests.regression.runsettings",
      "group": "test",
      "problemMatcher": "$msCompile",
      "presentation": {
        "clear": true
      }
    },
    {
      "label": "Test: Integration",
      "detail": "Run integration tests only (requires external dependencies)",
      "type": "shell",
      "command": "dotnet test tests/integration/Tests.Integration.csproj --no-restore --nologo && dotnet test tests/public-api/Tests.PublicApi.csproj --no-restore --nologo",
      "group": "test",
      "problemMatcher": "$msCompile",
      "presentation": {
        "clear": true
      }
    },
    {
      "label": "Test: All tests",
      "detail": "Run all tests including integration tests",
      "type": "shell",
      "command": "dotnet test --no-restore --nologo",
      "group": "test",
      "problemMatcher": "$msCompile",
      "presentation": {
        "clear": true
      }
    },
    {
      "label": "Test: Unit tests with coverage",
      "detail": "Run tests with coverage collection",
      "type": "shell",
      "command": "dotnet test --collect:\"Code Coverage\" --no-restore --nologo",
      "group": "test",
      "problemMatcher": "$msCompile",
      "presentation": {
        "clear": true
      }
    },
    {
      "label": "Test: Performance (all)",
      "detail": "Run all BenchmarkDotNet performance tests (Release mode)",
      "type": "shell",
      "command": "dotnet run --project tools/performance/Tests.Performance.csproj -c Release",
      "group": "test",
      "problemMatcher": "$msCompile",
      "presentation": {
        "clear": true,
        "panel": "dedicated",
        "group": "performance"
      }
    },
    {
      "label": "Test: Performance (Series)",
      "detail": "Run Series indicator benchmarks only (Release mode)",
      "type": "shell",
      "command": "dotnet run --project tools/performance/Tests.Performance.csproj -c Release -- --filter *SeriesIndicators*",
      "group": "test",
      "problemMatcher": "$msCompile",
      "presentation": {
        "clear": true,
        "panel": "dedicated",
        "group": "performance"
      }
    },
    {
      "label": "Test: Performance (Buffer)",
      "detail": "Run Buffer indicator benchmarks only (Release mode)",
      "type": "shell",
      "command": "dotnet run --project tools/performance/Tests.Performance.csproj -c Release -- --filter *BufferIndicators*",
      "group": "test",
      "problemMatcher": "$msCompile",
      "presentation": {
        "clear": true,
        "panel": "dedicated",
        "group": "performance"
      }
    },
    {
      "label": "Test: Performance (Stream)",
      "detail": "Run Stream indicator benchmarks only (Release mode)",
      "type": "shell",
      "command": "dotnet run --project tools/performance/Tests.Performance.csproj -c Release -- --filter *StreamIndicators*",
      "group": "test",
      "problemMatcher": "$msCompile",
      "presentation": {
        "clear": true,
        "panel": "dedicated",
        "group": "performance"
      }
    },
    {
      "label": "Run: Doc site with LiveReload (external browser)",
      "detail": "Serve VitePress docs site with hot reload (port 5173, opens browser)",
      "type": "shell",
      "command": "pnpm run docs:dev -- --open",
      "dependsOn": "Install: NPM (pnpm) packages",
      "isBackground": true,
      "runOptions": {
        "instanceLimit": 1
      },
      "options": {
        "cwd": "${workspaceFolder}/docs"
      },
      "problemMatcher": {
        "owner": "vitepress",
        "pattern": {
          "regexp": ".*",
          "file": 0,
          "line": 0,
          "column": 0,
          "message": 0
        },
        "background": {
          "activeOnStart": true,
          "beginsPattern": ".*vitepress.*",
          "endsPattern": ".*Local:.*http.*"
        }
      },
      "presentation": {
        "clear": true,
        "panel": "dedicated",
        "group": "hosted"
      }
    },
    {
      "label": "Run: Doc site with LiveReload (Simple Browser)",
      "detail": "Serve VitePress docs site on port 5174 with hot reload (VS Code Simple Browser)",
      "type": "shell",
      "command": "pnpm run docs:dev -- --port 5174",
      "dependsOn": "Install: NPM (pnpm) packages",
      "isBackground": true,
      "runOptions": {
        "instanceLimit": 1
      },
      "options": {
        "cwd": "${workspaceFolder}/docs"
      },
      "problemMatcher": {
        "owner": "vitepress",
        "pattern": {
          "regexp": ".*",
          "file": 0,
          "line": 0,
          "column": 0,
          "message": 0
        },
        "background": {
          "activeOnStart": true,
          "beginsPattern": ".*vitepress.*",
          "endsPattern": ".*Local:.*http.*"
        }
      },
      "presentation": {
        "clear": true,
        "panel": "dedicated",
        "group": "hosted"
      }
    },
    {
      "label": "Run: Doc site (serve only)",
      "detail": "Serve VitePress docs site (background, port 5173, no browser open)",
      "type": "shell",
      "command": "pnpm run docs:dev",
      "dependsOn": "Install: NPM (pnpm) packages",
      "isBackground": true,
      "runOptions": {
        "instanceLimit": 1
      },
      "options": {
        "cwd": "${workspaceFolder}/docs"
      },
      "problemMatcher": {
        "owner": "vitepress",
        "pattern": {
          "regexp": ".*",
          "file": 0,
          "line": 0,
          "column": 0,
          "message": 0
        },
        "background": {
          "activeOnStart": true,
          "beginsPattern": ".*vitepress.*",
          "endsPattern": ".*Local:.*http.*"
        }
      },
      "presentation": {
        "clear": true,
        "panel": "dedicated",
        "group": "hosted"
      }
    },
    {
      "label": "Build: Documentation site",
      "detail": "Build VitePress docs site for production",
      "type": "shell",
      "command": "pnpm run docs:build",
      "dependsOn": "Install: NPM (pnpm) packages",
      "options": {
        "cwd": "${workspaceFolder}/docs"
      },
      "problemMatcher": [],
      "presentation": {
        "clear": true,
        "panel": "shared"
      }
    },
    {
      "label": "Preview: Documentation site",
      "detail": "Preview production build of VitePress docs site",
      "type": "shell",
      "command": "pnpm run docs:preview -- --open",
      "dependsOn": "Build: Documentation site",
      "isBackground": true,
      "options": {
        "cwd": "${workspaceFolder}/docs"
      },
      "problemMatcher": {
        "owner": "vitepress",
        "pattern": {
          "regexp": ".*",
          "file": 0,
          "line": 0,
          "column": 0,
          "message": 0
        },
        "background": {
          "activeOnStart": true,
          "beginsPattern": ".*vitepress.*",
          "endsPattern": ".*Local:.*http.*"
        }
      },
      "presentation": {
        "clear": true,
        "panel": "dedicated",
        "group": "hosted"
      }
    },
    {
      "label": "Run: Test application",
      "detail": "Run the test application tool (exercises all indicators)",
      "type": "shell",
      "command": "dotnet run --project tools/application/Test.Application.csproj",
      "group": "none",
      "problemMatcher": "$msCompile",
      "presentation": {
        "clear": true,
        "panel": "dedicated",
        "group": "hosted"
      }
    },
    {
      "label": "Run: Simulation demo",
      "detail": "Run streaming indicators simulation demo",
      "type": "shell",
      "command": "dotnet run --project tools/simulate/Test.Simulation.csproj",
      "group": "none",
      "problemMatcher": "$msCompile",
    },
    {
      "label": "Run: Generate test baseline data (all)",
      "detail": "Generate all regression test baseline JSON files",
      "type": "shell",
      "command": "dotnet run --project tools/baselining/Test.DataGenerator.csproj -- --all",
      "group": "none",
      "problemMatcher": "$msCompile"
    },
    {
      "label": "Setup: Dev tools",
      "detail": "Complete one-time environment setup (global tools, SpecKit, packages)",
      "type": "shell",
      "command": "bash .devcontainer/startup.sh",
      "problemMatcher": [
        "$msCompile",
        "$eslint-compact"
      ]
    },
    {
      "label": "Stop: All hosted servers",
      "detail": "Stop all running VitePress dev servers and preview servers",
      "type": "shell",
      "command": "taskkill /F /IM node.exe /T 2>nul || echo No servers running",
      "group": "none",
      "problemMatcher": [],
      "presentation": {
        "reveal": "silent",
        "panel": "shared"
      }
    },
  ]
}
